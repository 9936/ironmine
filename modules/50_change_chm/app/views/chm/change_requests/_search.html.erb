<% results.values.each do |value| %>
    <li>
      <!-- 显示变更单 -->
      <% if value[:hit].nil? %>
          <% title = value[:result][:title] %>
          <% summary =  truncate(value[:result][:summary],{:length => 100,:omission => '......'}) %>
          <% id = value[:result][:id] %>
          <% updated_at = value[:result][:updated_at] %>
          <% journals_content = '' %>
      <% else %>
          <% title = search_result_highlight(value[:hit], :title) %>
          <% summary = search_result_highlight(value[:hit], :summary) %>
          <% id = value[:hit].result[:id] %>
          <% updated_at =  value[:hit].result[:updated_at] %>
          <% journals_content = search_result_highlight(value[:hit], "journals_content") %>
      <% end %>
      <h3 class="title">【<%= t :label_chm_change_request %>】
        <%= link_to(title, {:controller=>"chm/change_requests",:action=>"show",:id => id}) %>
      </h3>
      <p class="content"><%= summary %></p>
      <p class="meta">
        <!-- 显示回复的内容 -->
        <span class="reply"><%= journals_content %></span>
      </p>
      <p class="meta">
        <%= format_date(updated_at) %>
      </p>
    </li>
<% end %>


<% if @results.any? %>
    <ul>
      <%= show_search_result(params[:q], params[:search_option_str], params[:time_option]) %>

      <% @results.values.each do |value| %>
          <li>
            <!-- 显示事故单 -->
            <% if (value[:hit].present? && value[:hit].result.class.to_s.eql?('Icm::IncidentRequest')) || value[:result].class.to_s.eql?('Icm::IncidentRequest') %>
                <% if value[:hit].nil? %>
                    <% title = value[:result][:title] %>
                    <% summary = plain_text(value[:result][:summary]) %>
                    <% id = value[:result][:id] %>
                    <% updated_at = value[:result][:updated_at] %>
                    <% journals_content = '' %>
                <% else %>
                    <% title = search_result_highlight(value[:hit], :title) %>
                    <% summary = plain_text(search_result_highlight(value[:hit], :summary)) %>
                    <% id = value[:hit].result[:id] %>
                    <% updated_at =  value[:hit].result[:updated_at] %>
                    <% journals_content = plain_text(search_result_highlight(value[:hit], "journals_content")) %>
                <% end %>
                <h3 class="title">【<%= t :label_icm_incident_request %>】
                  <%= link_to(title, {:controller=>"icm/incident_journals",:action=>"new",:request_id => id}) %>
                </h3>
                <p class="content"><%= summary %></p>
                <p class="meta">
                  <span class="reply"><%= journals_content %></span>
                </p>

                <p class="meta">
                  <%= format_date(updated_at) %>
                </p>
                <!-- 显示知识库 -->
            <% elsif (value[:hit].present? && value[:hit].result.class.to_s.eql?('Skm::EntryHeader')) || value[:result].class.to_s.eql?('Skm::EntryHeader') %>
                <% if value[:hit].nil? %>
                    <% entry_title = value[:result][:entry_title] %>
                    <% entry_id = value[:result][:id] %>
                    <% entry_content = entry_header_content(value[:result]) %>
                    <% updated_at = value[:result][:updated_at] %>
                    <% keyword_tags = value[:result][:keyword_tags] %>
                <% else %>
                    <% entry_title = search_result_highlight(value[:hit], :entry_title) %>
                    <% entry_id = value[:hit].result[:id] %>
                    <% entry_content = search_result_highlight(value[:hit], "entry_content") %>
                    <% updated_at = value[:hit].result[:updated_at] %>
                    <% keyword_tags = value[:hit].result[:keyword_tags] %>
                <% end %>
                <h3 class="title">【<%= t :label_skm_entry_header %>】
                  <%= link_to(entry_title, {:controller => "skm/entry_headers", :action=>"show",:id => entry_id }) %>
                </h3>
                <p class="meta"><%=t(:label_skm_entry_header_keyword_tags)%>:<%= keyword_tags %></p>
                <p class="content">
                  <!-- 知识库中的内容 -->
                  <%= entry_content %>
                </p>
                <p class="meta"><%= format_date(updated_at) %></p>
                <!-- 显示变更单 -->
            <% elsif (value[:hit].present? && value[:hit].result.class.to_s.eql?('Chm::ChangeRequest')) || value[:result].class.to_s.eql?('Chm::ChangeRequest') %>
                <% if value[:hit].nil? %>
                    <% title = value[:result][:title] %>
                    <% summary =  truncate(value[:result][:summary],{:length => 100,:omission => '......'}) %>
                    <% id = value[:result][:id] %>
                    <% updated_at = value[:result][:updated_at] %>
                    <% journals_content = '' %>
                <% else %>
                    <% title = search_result_highlight(value[:hit], :title) %>
                    <% summary = search_result_highlight(value[:hit], :summary) %>
                    <% id = value[:hit].result[:id] %>
                    <% updated_at =  value[:hit].result[:updated_at] %>
                    <% journals_content = search_result_highlight(value[:hit], "journals_content") %>
                <% end %>
                <h3 class="title">【<%= t :label_chm_change_request %>】
                  <%= link_to(title, {:controller=>"chm/change_requests",:action=>"show",:id => id}) %>
                </h3>
                <p class="content"><%= summary %></p>
                <p class="meta">
                  <!-- 显示回复的内容 -->
                  <span class="reply"><%= journals_content %></span>
                </p>
                <p class="meta">
                  <%= format_date(updated_at) %>
                </p>
                <!-- 显示搜索结果中的公告 -->
            <% elsif (value[:hit].present? && value[:hit].result.class.to_s.eql?('Irm::Bulletin')) || value[:result].class.to_s.eql?('Irm::Bulletin') %>
                <% if value[:hit].nil? %>
                    <% title = value[:result][:title] %>
                    <% content =  truncate(value[:result][:content],{:length => 100,:omission => '......'}) %>
                    <% id = value[:result][:id] %>
                    <% updated_at = value[:result][:updated_at] %>
                <% else %>
                    <% title = search_result_highlight(value[:hit], :title) %>
                    <% content = search_result_highlight(value[:hit], :content) %>
                    <% id = value[:hit].result[:id] %>
                    <% updated_at =  value[:hit].result[:updated_at] %>
                <% end %>
                <h3 class="title">【<%= t :label_irm_bulletin %>】
                  <%= link_to(title, {:controller=>"irm/bulletins",:action=>"show",:id => id}) %>
                </h3>
                <p class="content"><%= content %></p>
                <p class="meta"><%= format_date(updated_at) %></p>
                <!-- 文件列表 -->
            <% elsif value[:hit].present? && value[:hit].result.class.to_s.eql?('Irm::AttachmentVersion') %>
                <h3 class="title">【<%= t :label_search_attachment %>】
                  <%= link_to(search_result_highlight(value[:hit], :data_file_name), value[:hit].result.url) %>
                </h3>
                <p class="content"><%= search_result_highlight(value[:hit], :data_path) %></p>
                <p class="meta"><%= format_date(value[:hit].result[:updated_at]) %></p>
            <% end %>
            <!-- 附件列表 -->
            <% if !value[:attachments].nil? && value[:attachments].any?  %>
                <% value[:attachments].each do |hit| %>
                    <div class="box">
                      <ul>
                        <li>
                          <h3 class="title">
                            <i class="attachment" title="<%= t :label_search_attachment %>"></i>
                            <%= search_result_highlight(hit, :data_file_name) %>
                          </h3>
                          <p class="content">
                            <!-- 知识库中的内容 -->
                            <%= search_result_highlight(hit, "data_path") %>
                          </p>
                        </li>
                      </ul>
                    </div>
                <% end %>
            <% end %>
          </li>
      <% end %>
    </ul>
    <!-- 显示没有搜索结果提示 -->
<% else %>
    <div class="alert alert-block" style="margin: 20px 0 0;">
      <p>
        <strong>Oh sorry! Please try again and check as the following:</strong>
      </p>
      <ul style="margin: 10px 5px;">
        <li><%= t :label_search_no_result_alert_1 %></li>
        <li><%= t :label_search_no_result_alert_2 %></li>
        <li><%= t :label_search_no_result_alert_3 %></li>
        <li><%= t :label_search_no_result_alert_4 %></li>
      </ul>
    </div>
<% end %>
