<%= common_title({:action_meaning=>"",:action_meaning=>t(:label_chm_change_approval), :buttons => ""}) %>

<style type="text/css">
  #baseInfoSubPageBlockHeader{
      border: 0;
  }
</style>
<%= page_block("show_Request",:show=>true) do |pb| %>

    <%= pb.page_block_body do %>

        <%= sub_page_block("baseInfo") do |spb|%>
            <%= spb.sub_page_block_header(:title=>"(#{@change_request[:change_status_name]})[#{@change_request[:request_number]}]#{@change_request[:title]}") do %>
            <% end %>

            <%= spb.sub_page_block_body do %>
                <table class="detailList infoList" cellpadding="0" cellspacing="0" border="0">
                  <tbody>
                      <tr>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_external_system)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:external_system_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_category)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:category_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_sub_category)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:sub_category_name] %></div></td>
                      </tr>
                      <tr>
                        <td class="label3Col"><label ><%=t(:label_icm_incident_request_organization)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:organization_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_requested_by)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:requested_by_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_requested_by_role)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:requested_role_name] %></div></td>
                      </tr>
                      <tr>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_contact)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:contact_name] %>(<%= @change_request[:contact_number] %>)</div></td>
                        <td class="label3Col"><label ><%=t(:label_icm_incident_request_submitted_by)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:submitted_by_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_icm_incident_request_submitted_date)%></label></td>
                        <td class="data3Col"><div><%= format_date(@change_request[:submitted_date]) %></div></td>
                      </tr>

                      <tr>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_change_priority)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:change_priority_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_change_urgency)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:change_urgency_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_change_impact)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:change_impact_name] %></div></td>
                      </tr>
                      <tr>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_change_status)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:change_status_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_support_group)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:support_group_name] %></div></td>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_support_person)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:support_person_name] %></div></td>
                      </tr>
                      <tr>
                        <td class="label3Col"><label ><%=t(:label_chm_change_request_request_type)%></label></td>
                        <td class="data3Col"><div><%= @change_request[:request_type_name] %></div></td>
                        <td class="label3Col"></td>
                        <td class="data3Col"><div></div></td>
                        <td class="label3Col"></td>
                        <td class="data3Col"><div></div></td>
                      </tr>
                  </tbody>
                </table>
            <% end %>
        <% end %>

    <% end %>
<% end %>

<%= page_block("tasks") do |pb| %>
    <%= pb.page_block_header({:title=>t(:label_chm_change_request_task)}) do%>
    <% end %>

    <%= pb.page_block_body do %>
      <%= render :partial=>"chm/change_tasks/tasks",:locals=>{:datas=>change_tasks(@change_request.id)} %>
    <% end %>
<% end %>

<%= page_block("showRequest") do |pb| %>
    <%= pb.page_block_header({:title=>t(:label_chm_change_request_incident_requests)}) do%>

    <% end %>

    <%= pb.page_block_body do %>
        <%= render :partial=>"chm/change_incident_relations/change_incident_requests",:locals=>{:datas=>change_incident_requests(@change_request.id),:master_incident_request=>change_master_incident_request(@change_request.incident_request_id)} %>
    <% end %>
<% end %>

<!--审批form-->


<%= form_for(@change_approval,:url=>{:action=>"decide"},:builder => LabellingFormBuilder) do |f| %>
    <%= page_block("newImpact") do |pb|%>
        <%= pb.page_block_header(:title=>t(:label_chm_change_approval_approve)) do %>
          <td id="topButtonRow" class="pbButton">
          </td>
          <td class="pbHelp">
          </td>

        <% end %>
       <%= pb.page_block_body do %>
            <%= sub_page_block("baseInfo") do |spb|%>
                <%= spb.sub_page_block_header(:title=>t(:label_common_info),:first=>true)%>
                <%= spb.sub_page_block_body do %>
                    <table class="detailList" cellpadding="0" cellspacing="0" border="0">
                      <tbody>
                        <tr>
                           <td class="labelCol"><label for="wf_step_instance_comment"><%=t(:label_chm_change_approval_comment)%></label></td>
                           <td class="dataCol" colspan="3" width="82%">
                             <%=f.text_area :comment,:rows=>5,:cols=>80,:id=>"wf_step_instance_comment"%>
                           </td>
                        </tr>
                        <tr>
                          <td class="labelCol empty">&nbsp;</td>
                          <td class="dataCol empty">&nbsp;</td>
                          <td class="labelCol empty">&nbsp;</td>
                          <td class="dataCol empty">&nbsp;</td>
                        </tr>
                      </tbody>
                    </table>
                <% end %>
          <% end %>
        </div>
        <%= pb.page_block_footer do %>
          <td id="topButtonRow" class="pbButton">
            <div class="button"><%= f.submit t(:label_irm_wf_step_instance_approved)%></div>
            <div class="button"><%= link_to t(:label_irm_wf_step_instance_reject),{:action => "decide",:reject=>Irm::Constant::SYS_YES},:class=>"submit"%></div>
            <div class="button"><%= link_back %></div>
          </td>
        <% end %>
    <% end %>
    <% end %>
<% end %>