<%= common_title(:action_meaning=> t(:new)) %>

<% temp_master_id = @temp_master_id%>

    <% content_for :item do %>
        <%= form_for(@master_item, :url=>{:action=>"add_item", :master_id => temp_master_id, :format => "js"},
                     :builder => CustomFormBuilder,
                     :html => {:multipart => true, :target => "frame"}) do |f| %>

            <iframe id='frame' name="frame" style="width:1px;height:1px;border:0px" src="about:blank"></iframe>
            <table class="form-table">
              <tbody>
              <tr>
                <td class="label-col"><label>Item Code</label></td>
                <td class="data-col">
                  <%= text_field_tag :item_code%>
                </td>
                <td class="label-col"><label>Item Description</label></td>
                <td class="data-col">
                  <%= text_area_tag :item_description%>
                </td>
              </tr>
              <tr>
                <td class="label-col"><label>Organization</label></td>
                <td class="data-col">
                  <%= text_field_tag :organization%>
                </td>
                <td class="label-col"><label>Template</label></td>
                <td class="data-col">
                  <%= select_tag_alias :template, Irm::LookupValue.query_by_lookup_type("MAM_TEMPLATE").order_by_sequence.multilingual.collect{|m| ["#{m.lookup_code}-#{m[:meaning]}", m.lookup_code]}%>
                </td>
              </tr>
              <tr>
                <td class="label-col"><label>Reference Item</label></td>
                <td class="data-col">
                  <%= text_field_tag :reference_item%>
                </td>
                <td class="label-col"><label>Primary Unit of Measure</label></td>
                <td class="data-col">
                  <%= text_field_tag :primary_unit%>
                </td>
              </tr>
              <tr>
                <td class="label-col"><label>Department</label></td>
                <td class="data-col">
                  <%= text_area_tag :department%>
                </td>
                <td class="label-col"><label>Business Unit</label></td>
                <td class="data-col">
                  <%= text_area_tag :business_unit%>
                </td>
              </tr>
              <tr>
                <td class="label-col"><label>Inventory Account</label></td>
                <td class="data-col">
                  <%= text_area_tag :inventory_account%>
                </td>
                <td class="label-col"><label>Inventory Sub-Account</label></td>
                <td class="data-col">
                  <%= text_area_tag :inventory_sub_account%>
                </td>
              </tr>
              <tr>
                <td class="label-col"><label>Serial Number Generation</label></td>
                <td class="data-col">
                  <%= text_field_tag :sn_generation%>
                </td>
              </tr>
              <tr>
                <td class="label-col"></td>
                <td class="label-col"><%= link_submit "Add",{:class=>"btn btn-primary"}%></td>
              </tr>
              </tbody>
            </table>
        <% end %>
    <% end%>

    <!--页面结构-->
    <div class="page-block">

      <%= form_for(@master,:url=>{:action=>"create_item"},:builder => CustomFormBuilder,:html => { :multipart => true }) do |f| %>
      <table class="page-block-header"><tr>
        <td class="page-block-title">
          <h2 class="block-title">New Master-Item</h2>
        </td>
        <td class="page-block-button">
          <%= link_submit t(:save),{:class=>"btn btn-primary"}%>
          <%= link_to t(:cancel),{:action => "index"},{:class=>"btn cancel"}%>
        </td>
      </tr></table>
      <%= error_for @master %>
      <div class="page-block-body">
        <div class="sub-page-block">
          <div class="sub-page-block-header">
            <h3 class="sub-page-block-title">Master Info</h3>
          </div>
          <div class="sub-page-block-body">
            <%= hidden_field_tag :return_url,@return_url %>
            <%= hidden_field_tag :temp_master_id,temp_master_id %>
            <table class="form-table">
              <tbody>
              <tr>
                <td class="label-col"><label>Requester</label></td>
                <td class="data-col">
                  <label>Requester</label>
                </td>
              </tr>
              <tr>
                <td class="label-col"><label>System</label></td>
                <td class="data-col">
                  <%=f.select :system_id, mam_ava_system_for_person(Irm::Person.current.id)%>
                </td>
              </tr>
              <tr>
                <td class="label-col"><label>Category</label></td>
                <td class="data-col">
                  <%=f.select :category, available_lookup_type("MAM_ITEM_CATEGORY"),{:value=>@master.category}%>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <% end %>
      <div class="page-block-body">
        <div class="sub-page-block">
          <div class="sub-page-block-header">
            <h3 class="sub-page-block-title">Item Info</h3>
          </div>
          <div class="sub-page-block-body">
            <%= content_for :item %>
          </div>
        </div>
      </div>

      <div class="page-block-body">
        <div class="sub-page-block">
          <div class="sub-page-block-header">
            <h3 class="sub-page-block-title">Item Added</h3>
          </div>
          <div class="sub-page-block-body">
            <%= datatable("master_item",{:action=>"get_item_data",:master_id => temp_master_id},[],{:paginator_box=>"masterItemPaginator"})%>
          </div>
        </div>
      </div>
    </div>
