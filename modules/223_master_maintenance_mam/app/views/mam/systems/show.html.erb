<%= common_title(:show_data=>@system[:system_name]) %>

<!--页面结构-->
<div class="show-block">
  <table class="page-block-header"><tr>
    <td class="page-block-title">
      <h2 class="block-title">MM System</h2>
    </td>
    <td class="page-block-button">
      <%= link_to t(:edit), {:action => "edit", :id => @system},:class=>"btn btn-primary"%>
      <%= link_to t(:new), {:action => "new"},:class=>"btn"%>
      <%= link_to t(:back), {:action => "index"},:class=>"btn" %>
    </td>
  </tr></table>
  <div class="page-block-body">
    <table class="show-table">
      <tbody>
          <tr>
            <td class="label-col"><label>System Name</label></td>
            <td class="data-col"><%= @system.system_name%></td>
            <td class="label-col"></td>
            <td class="data-col"></td>
          </tr>
          <tr>
            <td class="label-col"><label><%=(t :status)%></label></td>
            <td class="data-col"><%= @system[:status_meaning]%></td>
          </tr>
      </tbody>
    </table>
  </div>
</div>

<%= form_for(@system_person,:url=>{:action=>"add_people", :system_id => @system.id},:builder => CustomFormBuilder) do |f| %>
    <%= f.hidden_field(:status_code) %>
    <!--页面结构-->
    <div class="page-block unreal-hidden" id="select_people">
      <table class="page-block-header"><tr>
        <td class="page-block-title">
          <h2 class="block-title">Add People&nbsp;<%= t(:label_irm_select_result) %></h2>
        </td>
        <td class="page-block-button">
          <%= content_for :form_buttons %>
        </td>
      </tr></table>
      <%= error_for @system_person %>
        <div class="sub-page-block">
          <table class="page-block-header"><tr>
            <td class="page-block-title">
              <h2 class="block-title">Select People&nbsp;【<%= t(:label_irm_select_result) %>】</h2>
            </td>
            <td class="page-block-help">
              <div id="selectablePeopleSearchBox"></div>
            </td>
          </tr></table>

          <div class="sub-page-block-body">
            <%= datatable("selectablePeople",{:controller=>"mam/system_people", :action=>"get_available_people_data", :system_id => @system.id}, [],{:paginator_box=>"selectablePeoplePaginator",:search_box=>"selectablePeopleSearchBox",:select=>"multiple"})%>
          </div>
        </div>
      </div>
      <table class="page-block-footer">
        <tr>
          <td class="page-block-title"></td>
          <td class="page-block-button">
            <%= content_for :form_buttons   %>
          </td>
        </tr>
      </table>
    </div>
<% end %>

<!--页面结构-->
<%= form_for(@system_person,:url=>{:action=>"delete_people", :system_id => @system.id},:builder => CustomFormBuilder) do |f| %>
    <%= f.hidden_field(:temp_id_string, :value => "") %>
    <div class="page-block" id="member_grid">
      <table class="page-block-header"><tr>
        <td class="page-block-title">
          <h2 class="block-title"><%= t(:label_irm_external_system_people) %></h2>
        </td>
        <td class="page-block-button">
          <%= link_submit t(:delete_selected), :confirm => t(:label_are_you_sure),:class=>"btn btn-danger"%>
          <%= link_to t(:label_irm_external_system_add_people),{}, :href => "javascript:void(0)", :onclick=>"display_select_people()",:class=>"btn btn-info" %>
        </td>
        <td class="page-block-help">
          <div id="external_peopleSearchBox"></div>
        </td>
      </tr></table>
      <div class="page-block-body">
        <div id="system_people"></div>
        <%= datatable("system_people",{:controller => "mam/system_people",:action=>"get_owned_members_data",:format=>"json", :system_id => @system.id},[],{:row_perpage=>10,:search_box=>"system_peopleSearchBox",:paginator_box=>"system_peoplePaginatorBox",:select=>"multiple"})%>
        <div id="system_peoplePaginatorBox"></div>
      </div>
      <table class="page-block-footer">
        <tr>
          <td class="page-block-title"></td>
          <td class="page-block-button">
            <%= link_submit t(:delete_selected), :confirm => t(:label_are_you_sure),:class=>"btn btn-danger"%>
            <%= link_to t(:label_irm_external_system_add_people),{}, :href => "javascript:void(0)", :onclick=>"display_select_people()",:class=>"btn btn-info" %>
          </td>
        </tr>
      </table>
    </div>
<% end %>

<script type="text/javascript">
    function display_select_people(){
        $("#select_people").removeClass("unreal-hidden");
        $("#member_grid").addClass("unreal-hidden");
        $("#mam_system_person_temp_id_string").val("");
    }

    function display_member_grid(){
        $("#select_people").addClass("unreal-hidden");
        $("#member_grid").removeClass("unreal-hidden");
        $("#mam_system_person_status_code").val("");
    }


    $(document).ready(function(){
        $("#system_people").bind('selectionchange',function(event,ids){
            $("#mam_system_person_temp_id_string").val(ids.join(","));
        });

        $("#selectablePeople").bind('selectionchange',function(event,ids){
            $("#mam_system_person_status_code").val(ids.join(","));
        });


        $("#delete_system_group .delete-support-group-btn").bind("click", function(e){
            if(!$(this).hasClass("disabled")) {
                $("#deleteGroupModal").modal("show");
            }
            e.preventDefault();
        });
    });
</script>