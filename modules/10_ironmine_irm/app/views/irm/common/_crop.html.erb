<%= image_tag source.avatar.url(:original), :id => "crop_box" %>
<% require_jscss(:jcrop) %>
<% require_jcss(:jcrop_ie6) if ie6? %>
<script type="text/javascript">
  $(function(){
      var currentSelect = [0, 0, 100, 100];
      <% if defined?(best_size)%>
        currentSelect = <%=[0,0]+best_size %>;
      <% end%>
      $('#crop_box').Jcrop({
          onSelect: onSelect,
          bgChange: onChange,
          setSelect: currentSelect
      });
      function onChange(crop){
            $("#crop_x").val(crop.x);
            $("#crop_y").val(crop.y);
            $("#crop_w").val(crop.w);
            $("#crop_h").val(crop.h);
          <% if defined?(display_dom)%>
            $("#<%=display_dom%>").html("=>"+crop.w+"px X "+crop.h+"px");
          <%end%>
      }
      function onSelect(crop){
            $("#crop_x").val(crop.x);
            $("#crop_y").val(crop.y);
            $("#crop_w").val(crop.w);
            $("#crop_h").val(crop.h);
          <% if defined?(display_dom)%>
            $("#<%=display_dom%>").html("=>"+crop.w+"px X "+crop.h+"px");
          <%end%>
      }
  });
</script>
