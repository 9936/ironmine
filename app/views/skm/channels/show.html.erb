<% require_javascript(:extjs)  %>
<% require_css(:extjs)  %>

<%= setting_title %>
<div id="ep" class="detail-block page-block">
  <div class="pbHeader">
    <table cellpadding="0" cellspacing="0" border="0">
      <tbody>
        <tr>
          <td class="pbTitle"><h2 class="mainTitle"><%= t(:label_skm_channel) %></h2></td>
          <td id="topButtonRow" class="pbButton">
            <div class="button"><%= link_to t(:edit), {:action => "edit", :id => @channel}%></div>
            <div class="button"><%= link_to t(:back), {:action => "index"}%></div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="pbBody">
    <div class="pbSubsection">
      <table class="detailList" cellpadding="0" cellspacing="0" border="0">
        <tbody>
            <tr>
              <td class="labelCol"><label><%=(t :label_skm_channel_code)%></label></td>
              <td class="data2Col"><%= @channel.channel_code%></td>
            </tr>
            <tr>
              <td class="labelCol"><label><%=(t :name)%></label></td>
              <td class="data2Col"><%= @channel[:name]%></td>
            </tr>
            <tr>
              <td class="labelCol"><label><%=t(:description)%></label></td>
              <td class="data2Col"><%= @channel[:description]%></td>
            </tr>
            <tr>
              <td class="labelCol"><label><%=(t :active)%></label></td>
              <td class="data2Col"><%= check_img(@channel.status_code)%></td>
            </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="pbBody">
        <div class="pbSubheader tertiaryPalette">
          <h3><%= t(:label_common_info) %></h3>
        </div>
        <div class="pbSubsection">
          <table class="detailList" cellpadding="0" cellspacing="0" border="0">
            <tbody>
                <tr>
                  <td class="labelCol"></td>
                  <td class="data2Col">
                    <div id="tree-div" href="<%= url_for(:controller => "skm/columns", :action=>"get_columns_data",:format=>:json) %>"></div>
                  </td>
                </tr>
            </tbody>
          </table>
        </div>
    </div>
</div>
<script>
Ext.onReady(function() {
    var treeNode = Ext.getDom("tree-div");

    Ext.define('ColumnField', {
        extend: 'Ext.data.Model',
        fields: [
            {name: 'id',type: 'string'},
            {name: 'text',type: 'string'},
            {name: 'sc_id',type: 'string'},
            {name: 'column_name',type: 'string'},
            {name: 'column_description',type: 'string'},
            {name: 'column_accesses', type:'string'},
            {name: 'sc_code',type: 'string'}
        ]
    });
    var store = Ext.create('Ext.data.TreeStore', {
        model: "ColumnField",
        proxy: {type: 'ajax',url:  treeNode.getAttribute("href") + "?with_check=<%= @channel.column_ids%>"}
    });

    var tree = Ext.create('Ext.tree.Panel', {
        store: store,
        rootVisible: false,
        useArrows: true,
        renderTo: 'tree-div',
        width: 200,
        height: 250,
        listeners:{
            'itemclick':function(view, record, item, index, e){
                e.stopEvent(); // to prevent checking on html level
                return false; // to prevent check changing logic
            }
        }
    });

});
</script>
<%=render :partial=>"multilingual/show",:locals=>{:main_data=>@channel} %>