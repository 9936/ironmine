<% require_javascript(:extjs)  %>
<% require_css(:extjs)  %>

<%= setting_title %>
<div id="ep" class="detail-block page-block">
  <div class="pbHeader">
    <table cellpadding="0" cellspacing="0" border="0">
      <tbody>
        <tr>
          <td class="pbTitle"><h2 class="mainTitle"><%= t(:label_skm_channel) %></h2></td>
          <td id="topButtonRow" class="pbButton">
            <div class="button"><%= link_to t(:edit), {:action => "edit", :id => @channel}%></div>
            <div class="button"><%= link_to t(:back), {:action => "index"}%></div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="pbBody">
    <div class="pbSubsection">
      <table class="detailList" cellpadding="0" cellspacing="0" border="0">
        <tbody>
            <tr>
              <td class="labelCol"><label><%=(t :label_skm_channel_code)%></label></td>
              <td class="data2Col"><%= @channel.channel_code%></td>
            </tr>
            <tr>
              <td class="labelCol"><label><%=(t :name)%></label></td>
              <td class="data2Col"><%= @channel[:name]%></td>
            </tr>
            <tr>
              <td class="labelCol"><label><%=t(:description)%></label></td>
              <td class="data2Col"><%= @channel[:description]%></td>
            </tr>
            <tr>
              <td class="labelCol"><label><%=(t :active)%></label></td>
              <td class="data2Col"><%= check_img(@channel.status_code)%></td>
            </tr>
        </tbody>
      </table>
    </div>
  </div>
  <div class="pbBody">
        <div class="pbSubheader tertiaryPalette">
          <h3><%= t(:label_common_info) %></h3>
        </div>
        <div class="pbSubsection">
          <table class="detailList" cellpadding="0" cellspacing="0" border="0">
            <tbody>
                <tr>
                  <td class="labelCol"></td>
                  <td class="data2Col">
                    <div id="tree-div" href="<%= url_for(:controller => "skm/columns", :action=>"get_columns_data",:format=>:json) %>"></div>
                  </td>
                </tr>
            </tbody>
          </table>
        </div>
    </div>
</div>

<div class="bRelatedList">
    <div class="listRelatedObject setupBlock">
      <div class="page-block secondary-palette">
        <div class="pbHeader">
          <table cellspacing="0" cellpadding="0" border="0">
            <tbody>
            <tr>
              <td class="pbTitle">
                <h3><%=t(:label_irm_person_group)%></h3>
              </td>
              <td class="pbButton">
                <div class="button"><%= link_to t(:label_skm_channel_group_management), {:controller=>"skm/channels",
                                                          :action => "new_groups",:id=>@channel.id}%></div>
              </td>
              <td class="pbHelp">
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="pbBody lbBody">
          <div id="groupList" class="datatable" style="width:100%;">
            <div id="id" style="display:none">
              <%= icon_link_remove({:controller=>"skm/channels",:action=>"remove_group",:group_id=>"{id}",
                                      :channel_id=>@channel.id},:confirm => t(:label_are_you_sure) ,
                                      :method => :delete) %>
            </div>
          </div>
          <!-- Begin company access table -->
            <%= datatable("groupList",{:controller=>"skm/channels",:action=>"get_owned_groups_data",:id=>@channel.id,:format=>:json},
                              [{:key=>"id",:label=>t(:operation),:formatter=>"Y.irm.template",:width=>"60px"},
                               {:key=>"code",:label=>t(:label_irm_group_group_code), :width => "150px"},
                               {:key=>"name",:label=>t(:label_irm_group_name), :width => "150px"},
                               {:key=>"description",:label=>t(:label_irm_group_description)}])%>
          <!-- End company access table -->
        </div>
        <div class="pbFooter secondary-palette">
        <div class="bg"></div>
        </div>
      </div>
    </div>
</div>


<script>
Ext.onReady(function() {
    var treeNode = Ext.getDom("tree-div");

    Ext.define('ColumnField', {
        extend: 'Ext.data.Model',
        fields: [
            {name: 'id',type: 'string'},
            {name: 'text',type: 'string'},
            {name: 'sc_id',type: 'string'},
            {name: 'column_name',type: 'string'},
            {name: 'column_description',type: 'string'},
            {name: 'column_accesses', type:'string'},
            {name: 'sc_code',type: 'string'}
        ]
    });
    var store = Ext.create('Ext.data.TreeStore', {
        model: "ColumnField",
        proxy: {type: 'ajax',url:  treeNode.getAttribute("href") + "?with_check=<%= @channel.column_ids%>"}
    });

    var tree = Ext.create('Ext.tree.Panel', {
        store: store,
        rootVisible: false,
        renderTo: 'tree-div',
        width: 200,
        height: 250,
        listeners:{
            'itemclick':function(view, record, item, index, e){
                e.stopEvent(); // to prevent checking on html level
                return false; // to prevent check changing logic
            }
        }
    });

});
</script>
<%=render :partial=>"multilingual/show",:locals=>{:main_data=>@channel} %>