<%= form_for(@entry_header,:url=>{:action=>"new"},:builder => LabellingFormBuilder, :html => {:name => "new_skm_entry_header"}) do |f| %>
<div  class="bWizardBlock">
    <div class="pbWizardTitle tertiaryPalette">
        <div class="ptRightTitle">
            第 3 步，共 4 步
        </div>
        <h2>
            步骤 3。 选择附件和主题
        </h2>
    </div>
  <div class="pbBody">
    <div class="pbDescription ">
      为文章添加附件，以及选择所涉及到的主题      
    </div>
    <div class="pbWizardBody">
      <div class="secondaryPalette">
        <div class="pbBody">
            <div class="pbSubheader first tertiaryPalette">
              <h3>主题</h3>
            </div>
            <div class="pbSubsection">
              <table class="detailList" cellpadding="0" cellspacing="0" border="0" style="width:10%;padding-left: 20%;">
                <tbody>
                    <tr>
                      <td class="labelCol"></td>
                      <td class="labelCol" style="text-align:center">主题类型</td>
                      <td class="labelCol" style="text-align:center">主题</td>
                    </tr>
                <% counter = 1 %>
                <% @entry_header.entry_subjects.each do |e| %>
                <%= fields_for("skm_entry_header[entry_subjects][counter]", e) do |es| %>
                    <tr id="tr_<%= counter.to_s %>">
                      <td class="labelCol"><%= link_to t(:delete), {}, :href => "javascript:void(0);", :onclick => "delete_subject(#{counter})" %></td>
                      <td class="dataCol"><%= select "subject_type", counter.to_s, available_entry_subject_types.collect{|p| [p[:flex_value_meaning], p.id]}%></td>
                      <td class="dataCol"><%= es.select :subject_id, available_entry_subject_types.collect{|p| [p[:flex_value_meaning], p.id]}%></td>
                    </tr>
                <% counter = counter + 1 %>
                <% end %>
                <% end %>
                    <tr>
                      <td class="labelCol"></td>
                      <td class="labelCol" style="text-align:center"><%= link_to "增加主题", {}, :href => "javascript:void(0);"%></td>
                      <td class="labelCol" style="text-align:center"></td>
                    </tr>
                </tbody>
              </table>
            </div>
      </div>
    </div>
    </div>
    <div class="pbWizardFooter">
        <div class="pbBottomButtons">
            <table cellpadding="0" cellspacing="0" border="0">
              <tbody>
                <tr>
                  <td class="pbTitle"></td>
                  <td id="bottomButtonRow" class="pbButtonb">
                    <div class="button"><%= link_to t(:last), {}, {:href => "javascript:void(0);", :onclick => "submit_last()"}%></div>
                    <div class="button"><%= link_to t(:next), {}, {:href => "javascript:void(0);", :onclick => "submit_next()"}%></div>
                    <div class="button"><%= link_to t(:cancel), {:action => "index"} %></div>
                  </td>
                </tr>
              </tbody>
            </table>
        </div>
    </div>
  </div>
</div>
<script type="text/javascript">
  function submit_next(){
    document.new_skm_entry_header.action = "new?step=4";
    new_skm_entry_header.submit();
  }

  function submit_last(){
    document.new_skm_entry_header.action = "new?step=2";
    new_skm_entry_header.submit();
  }

  function delete_subject(tar){
    GY.use(function(Y){
        Y.one("#tr_" + tar).remove();
    })
  }

  function add_subject(tar){
    GY.use(function(Y){
        Y.one("#tr_");
    })
  }
</script>
<% end %>