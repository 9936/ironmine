<style type="text/css">
    .datatable table tbody table.table-icon {
        background-color: transparent;
        text-align: left;
    }

    .datatable table tbody table.table-icon tr {
        background-color: transparent;
    }

    .datatable table tbody table.table-icon tr td {
        background-color: transparent;
        border: none;
    }


    .datatable table tbody table.table-icon tr td.div {
        padding: 0px;
        border: none;
    }

    .datatable table tbody table.table-icon tr td.vt {
        width: 21px;
    }

    .table-icon a.expand-icon {
        background: url('../images/filter_hide.gifx') no-repeat 0 0 transparent;
        width: 16px;
        height: 16px;
        text-indent: -9999px;
        display: block;
    }

    .table-icon a.collapse-icon {
        background: url('../images/filter_reveal.gifx') no-repeat 0 0 transparent;
        width: 16px;
        height: 16px;
        text-indent: -9999px;
        display: none;
    }

    .table-icon .workflow {
        width: 18px;
        height: 18px;
    }

    .table-icon .requested {
        background: url('../images/workflow_requested.gif') no-repeat 0 0 transparent;
    }

    .table-icon .active {
        background: url('../images/workflow_active.gif') no-repeat 0 0 transparent;
    }

    .table-icon .pending {
        background: url('../images/workflow_pending.gif') no-repeat 0 0 transparent;
    }

    .table-icon .complete {
        background: url('../images/workflow_complete.gif') no-repeat 0 0 transparent;
    }

    .table-icon .closed {
        background: url('../images/workflow_approval_rejected.gif') no-repeat 0 0 transparent;
    }

    .table-icon td {
        background: transparent;
        border: none;
    }

    .table-icon td.expends div {
        float: left;
        display: inline;
        padding: 0;
        border: none;
    }

    .table-icon td.expand div {
        display: block;
        float: none;
    }

    .table-icon td.expends div.name {
        display: none;
    }

    .table-icon td.expand div.name  {
        display: block;
    }

    .table-icon .expand {
        min-width: 80px;
        display: block;
    }

    .table-icon .name {
        display: none;
        padding: 3px;

    }

    .table-icon .header-name {
        background: transparent;
        padding: 2px 3px !important;
        display: block;
        min-width: 50px;
    }

    .expand .name {
        display: inline-block;
        min-width: 60px;
        clear: left;
    }

    td.vt {
        vertical-align: top;
        padding: 4px 6px 4px 7px;
        white-space: normal;
        display: table-cell;
    }
</style>
<script type="text/javascript">
    $(document).ready(function () {
        $(".expand-icon").bind('click', function () {
            var parent_table = $(this).parent();
            parent_table.find(".collapse-icon").css("display", "block");
            $(this).hide();
            parent_table.parent().parent().find(".expends").addClass("expand");
        });
        $(".collapse-icon").bind('click', function () {
            var parent_table = $(this).parent();
            parent_table.find(".expand-icon").show();
            $(this).hide();
            parent_table.parent().parent().find(".expends").removeClass("expand");
        });
    });
</script>


<%= datatable_view({:count => @count, :datas => @datas}) do |builder| %>
    <% builder.column(:request_number, {:title => t(:label_chm_change_request_request_number), :width => "40px"}) %>
    <% builder.column(:title, {:title => t(:label_chm_change_request_title), :searchable => true, :width => "400px"}) do |data| %>
        <%= link_to(data.title, {:controller => 'chm/change_requests', :action => 'show', :id => data.id}) %>
    <% end %>
    <% builder.column(:change_status_id, {:title => t(:label_chm_change_request_stage), :width => "120px"}) do |data| %>
        <table class="table-icon">
          <tr>
            <td class="vt">
               <span>
                 <a class="expand-icon" href="javascript:void(0);" title="expand">expand</a>
                 <a class="collapse-icon" href="javascript:void(0);" title="collapse">collapse</a>
               </span>
            </td>
            <td class="expends"><%= build_stage_collapse(data.change_status_id) %></td>
          </tr>
        </table>
    <% end %>
    <% builder.column(:incidents, {:title => t(:label_chm_change_request_incident), :width => "120px"}) do |data| %>
        <table class="table-icon">
          <tr><%= change_incident_show(data[:incidents], data.id) %></tr>
        </table>
    <% end %>
    <% builder.column(:plans, {:title => t(:label_chm_change_request_plan), :width => "200px"}) do |data| %>
        <table class="table-icon">
          <tr>
            <%= change_pan_show(data) %>
          </tr>
        </table>
    <% end %>
    <% builder.column(:implements, {:title => t(:label_chm_change_request_implement), :width => "250px", :sortable => true}) do |data| %>
        <table class="table-icon">
          <tr><%= change_request_tasks(data.id) %></tr>
        </table>
    <% end %>
    <% builder.column(:approve_stauts, {:title => t(:label_chm_change_request_approve), :width => "130px"}) do |data| %>
        <%= data[:approve_status_meaning] %>
    <% end %>
    <% builder.column(:origanization_id, {:title => t(:label_chm_change_request_organization), :width => "130px"}) do |data| %>
        <%= data.organization_id_label %>
    <% end %>
    <% builder.column(:change_priority_id, {:title => t(:label_chm_change_request_change_priority), :width => "130px"}) do |data| %>
        <%= data.change_priority_id_label %>
    <% end %>
    <% builder.column(:requrested_by, {:title => t(:label_chm_change_request_requested_by), :width => "130px"}) do |data| %>
        <%= data.requested_by_label %>
    <% end %>
    <% builder.column(:submitted_date, {:title => t(:label_chm_change_request_submitted_date), :width => "130px"}) do |data| %>
        <%= format_date(data.submitted_date) %>
    <% end %>
    <% builder.column(:external_system_id_, {:title => t(:label_chm_change_request_external_system), :width => "130px"}) do |data| %>
        <%= data.external_system_id_label %>
    <% end %>
<% end %>

