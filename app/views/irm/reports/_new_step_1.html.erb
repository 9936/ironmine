<style type="text/css">
  select{
      min-width:128px;
  }
</style>
<div  class="wizard-block">
  <%= render :partial => "step_header",:locals => {:step=>@report.step} %>
  <div class="pbBody">
  <%= error_for @report%>
  <%= form_for(@report,:url=>{:action=>"new"},:builder => LabellingFormBuilder) do |f| %>
  <%= f.hidden_field(:step) %>
    <div class="pbDescription ">
    </div>
    <div class="pbWizardBody">
      <div class="secondary-palette">
        <div class="pbBody ">
            <div id="head_1_ep" class="pbSubheader first tertiaryPalette">
              <span class="pbSubExtra">
                <span class="requiredLegend">
                  <span class="requiredExampleOuter">
                    <span class="requiredExample">&nbsp;</span>
                  </span><span class="requiredMark">*</span>
                  <span class="requiredText"> = <%=t(:label_is_required)%></span>
                </span>
              </span>
              <h3><%= t(:label_irm_report_choose_report_type) %></h3>
            </div>
            <div class="pbSubsection">
                <table class="detailList" cellpadding="0" cellspacing="0" border="0">
                  <tbody>
                    <tr>
                      <td class="labelCol empty">&nbsp;</td>
                      <td class="dataCol empty">&nbsp;</td>
                      <td class="labelCol empty">&nbsp;</td>
                      <td class="dataCol empty">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="labelCol empty">&nbsp;</td>
                      <td width="82%" colspan="3" class="dataCol">
                        <table>
                          <thead>
                            <tr>
                              <th><%= t(:label_irm_report_choose_report_category) %></th>
                              <th><%= t(:label_irm_report_choose_report_type) %></th>
                              <th><%= t(:label_irm_report_type_description) %></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>
                                <%=select_tag_alias :category_id,available_report_type_category,{},:id=>"reportTypeCategory",:size=>14%>
                              </td>
                              <td>
                                <%=f.select :report_type_id,[],{:required=>true},:id=>"reportType",:size=>14%>
                              </td>
                              <td>
                                <label id="reportTypeDescription"></label>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
      </div>
    </div>
    <div class="pbWizardFooter">
        <div class="pbBottomButtons">
            <table cellpadding="0" cellspacing="0" border="0">
              <tbody>
                <tr>
                  <td class="pbTitle"></td>
                  <td id="bottomButtonRow" class="pbButtonb">
                    <div class="button" id="saveButton"><%= f.submit t :next%></div>
                    <div class="button"><%= link_to t(:cancel), {:action => "index"} %></div>
                  </td>
                </tr>
              </tbody>
            </table>
        </div>
    </div>
    <%end%>
  </div>
</div>

<% report_category_type_script %>
<script type="text/javascript">
  $(function(){
      $("#reportTypeCategory").change(function(event){
          var currentDataSets = reportTypeData[$("#reportTypeCategory").val()];
          $("#reportType").html("");
          for(var i in currentDataSets){
               var option = $("<option></option>");
               option.html(currentDataSets[i][0]);
               option.attr("value",currentDataSets[i][1]);
               option.attr("category_id",currentDataSets[i][2]);
               option.attr("description",currentDataSets[i][3]);
               $("#reportType").append(option);
          }
          if($("#reportType option:first").length>0)
              $("#reportType option:first").attr("selected",true);
          $("#reportType").trigger("change");
      });
      $("#reportType").change(function(event){
           var selectedValue = $("#reportType").val();
           if(selectedValue&&selectedValue!="")
           {
               $("#saveButton").removeClass("disabled");
               $("#saveButton input:first").removeAttr("disabled");
               $("#reportTypeDescription").html($("#reportType option[value="+selectedValue+"]:first").attr("description"));
           }
           else{
               $("#saveButton").removeClass("disabled");
               $("#saveButton input:first").attr("disabled","disabled");
           }
       });

      var needAutoSelect = true
       $("#reportTypeCategory option").each(
           function(index,element){
             if($(element).attr("selected"))
               needAutoSelect = false
           }
       );

       if(needAutoSelect&&$("#reportTypeCategory option:first").length>0)
           $("#reportTypeCategory option:first").attr("selected",true);
       $("#reportTypeCategory").trigger("change");
  });
</script>