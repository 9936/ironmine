<style type="text/css">
  select{
      min-width:128px;
  }
</style>
<div  class="bWizardBlock">
  <%= render :partial => "step_header",:locals => {:step=>@report.step} %>
  <div class="pbBody">
  <%= error_for @report%>
  <%= form_for(@report,:url=>{:action=>"new"},:builder => LabellingFormBuilder) do |f| %>
  <%= f.hidden_field(:step) %>
    <div class="pbDescription ">
    </div>
    <div class="pbWizardBody">
      <div class="secondaryPalette">
        <div class="pbBody ">
            <div id="head_1_ep" class="pbSubheader first tertiaryPalette">
              <span class="pbSubExtra">
                <span class="requiredLegend">
                  <span class="requiredExampleOuter">
                    <span class="requiredExample">&nbsp;</span>
                  </span><span class="requiredMark">*</span>
                  <span class="requiredText"> = <%=t(:label_is_required)%></span>
                </span>
              </span>
              <h3><%= t(:label_irm_report_choose_report_type) %></h3>
            </div>
            <div class="pbSubsection">
                <table class="detailList" cellpadding="0" cellspacing="0" border="0">
                  <tbody>
                    <tr>
                      <td class="labelCol empty">&nbsp;</td>
                      <td class="dataCol empty">&nbsp;</td>
                      <td class="labelCol empty">&nbsp;</td>
                      <td class="dataCol empty">&nbsp;</td>
                    </tr>
                    <tr>
                      <td class="labelCol empty">&nbsp;</td>
                      <td width="82%" colspan="3" class="dataCol">
                        <table>
                          <thead>
                            <tr>
                              <th><%= t(:label_irm_report_choose_report_category) %></th>
                              <th><%= t(:label_irm_report_choose_report_type) %></th>
                              <th><%= t(:label_irm_report_type_description) %></th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr>
                              <td>
                                <%=select_tag_alias :category_id,available_report_type_category,{},:id=>"reportTypeCategory",:size=>14%>
                              </td>
                              <td>
                                <%=f.select :report_type_id,[],{:required=>true},:id=>"reportType",:size=>14%>
                              </td>
                              <td>
                                <label id="reportTypeDescription"></label>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
      </div>
    </div>
    <div class="pbWizardFooter">
        <div class="pbBottomButtons">
            <table cellpadding="0" cellspacing="0" border="0">
              <tbody>
                <tr>
                  <td class="pbTitle"></td>
                  <td id="bottomButtonRow" class="pbButtonb">
                    <div class="button" id="saveButton"><%= f.submit t :next%></div>
                    <div class="button"><%= link_to t(:cancel), {:action => "index"} %></div>
                  </td>
                </tr>
              </tbody>
            </table>
        </div>
    </div>
    <%end%>
  </div>
</div>

<% report_category_type_script %>
<script type="text/javascript">
   GY.use(function(Y){
       Y.one("#reportTypeCategory").on("change",function(){
           var currentDataSets = reportTypeData[Y.one("#reportTypeCategory").get("value")];
           Y.one("#reportType").setContent("");
           for(var i in currentDataSets){
               var option = Y.Node.create("<option></option>");
               option.setContent(currentDataSets[i][0]);
               option.setAttribute("value",currentDataSets[i][1]);
               option.setAttribute("category_id",currentDataSets[i][2]);
               option.setAttribute("description",currentDataSets[i][3]);
               Y.one("#reportType").appendChild(option);
           }
           if(Y.one("#reportType option"))
               Y.one("#reportType option")._node.selected=true;
           Y.one("#reportType").simulate("change");
       });
       Y.one("#reportType").on("change",function(){
           var selectedValue = Y.one("#reportType").get("value")
           if(selectedValue&&selectedValue!="")
           {
               Y.one("#saveButton").setStyle("display","");
               Y.one("#reportTypeDescription").setContent(Y.one("#reportType option[value="+selectedValue+"]").getAttribute("description"));
           }
           else
               Y.one("#saveButton").setStyle("display","none");
       });
       var needAutoSelect = true
       Y.all("#reportTypeCategory option").each(
           function(e){
             if(e._node.selected)
               needAutoSelect = false
           }
       );

       if(needAutoSelect&&Y.one("#reportTypeCategory option"))
           Y.one("#reportTypeCategory option")._node.selected=true;
       Y.one("#reportTypeCategory").simulate("change");
   });

</script>