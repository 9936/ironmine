<%= app_title %>
<div class="listRelatedObject setupBlock">
    <div class="bPageBlock">
      <div class="pbHeader">
        <table cellpadding="0" cellspacing="0" border="0">
          <tbody>
            <tr>
              <td class="pbTitle"><h2 class="mainTitle"><%= t(:label_icm_role_assignable_people_list) %></h2></td>
              <td id="topButtonRow" class="pbButton">
                <%= form_tag({:action=>"update_assignment",:id=>@role.id}) do |f|%>
                  <%= hidden_field_tag(:person_ids,:id=>"person_ids")  %>
                  <div class="button"><%= submit_tag t(:save),{:id=>"formSubmit"}%></div>
                  <div class="button"><%= link_to(t(:cancel),{:action=>"show"})%></div>
                <% end %>
              </td>
              <td class="pbHelp">
                <div id="peopleSearchBox"></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="pbBody">

        <div id="people" class="datatable" style="width:100%">

        </div>
        <%= datatable("people",url_for(:action=>"assignable_people",:id=>@role.id,:format=>"json"),
                              [{:key=>"id",:width=>"80px", :hidden => true},
                               {:key=>"login_name",:label=>t(:label_irm_person_login),:sortable=>true,:searchable=>true,:width=>"80px"},
                               {:key=>"person_name",:label=>t(:label_irm_person_name),:sortable=>true,:searchable=>true,:width=>"120px"},
                               {:key=>"email_address",:label=>t(:label_irm_person_email_address),:searchable=>true},
                               {:key=>"bussiness_phone",:label=>t(:label_irm_person_bussiness_phone),:searchable=>true},
                               {:key=>"company_name",:label=>t(:label_irm_person_company),:sortable=>true,:searchable=>true}
                               ],{:select=>"multiple",:row_perpage=>10,:paginator_box=>'peoplePaginatorBox'})%>
        <div id="peoplePaginatorBox"></div>
      </div>
    </div>
</div>

<script type="text/javascript">
  GY.use("cascadeselect",function(Y){
      Y.on("irm:change",function(e){
          if(e.details[2]=="Datatable"&&"peopleDatatable"==e.details[0])
            e.details[1].on("selectedChange",function(e){
                var selected_requests = e.details[0];
                var ids = [];
                for(var i in selected_requests){
                  ids.push(selected_requests[i].id);
                }
                Y.one("#person_ids").set("value",ids.join(","));
                if(selected_requests.length>0)
                  Y.one("#formSubmit").removeAttribute("disabled");
                else
                  Y.one("#formSubmit").setAttribute("disabled",true);
            })
      });

  });
</script>
