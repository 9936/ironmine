<%= app_title({:title=>"#{t(:label_irm_report)}"}) %>
<div class="bOverviewSearch">
  <div>
    <div class="pbSearch">
      <%= form_tag(:action => "index") do %>
      <span class="bFilter">
        <label style="text-align: left; font-weight: bold; padding-right: 0.69em;"><%= t(:label_irm_report_category) %>：</label>
        <span class="fBody">
            <%= select_tag("report_category", options_for_select(available_report_categories, @report_category), {:include_blank => t(:select)}) %>
            <%= submit_tag t(:jump), :title => t(:jump), :class => "btn" %>
        </span>
        <span class="fFooter">
        </span>
      </span>
      <% end %>
    </div>
  </div>
</div>

<div class="listRelatedObject setupBlock">
    <div class="bPageBlock">
      <div class="pbHeader">
        <table cellpadding="0" cellspacing="0" border="0">
          <tbody>
            <tr>
              <td class="pbTitle"><h2 class="mainTitle"><%= t(:label_irm_report_list) %></h2></td>
              <td id="topButtonRow" class="pbButton">
              </td>
              <td class="pbHelp">
                <div id="permissionsSearchBox"></div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="pbBody">
        <div id="report_list" class="datatable" style="width:100%;">
          <div id="name" style="display:none">
            <a href="{page_controller}/{page_action}">{name}</a>
          </div>
        </div>
        <%= datatable("report_list",url_for(:action=>"get_data", :report_category => @report_category,:format=>"json"),
                  [{:key=>"id",:label=>t(:operation),:hidden => true},
                   {:key=>"name",:label=>t(:label_irm_report_name), :sortable=>true,:searchable=>true,:width=>"40%"},
                   {:key=>"description",:label=>t(:label_irm_report_description),:sortable=>true},
                   {:key=>"page_controller",:label=>t(:label_irm_report_page_controller),:hidden=>true},
                   {:key=>"page_action",:label=>t(:label_irm_report_page_action),:hidden=>true},],
                   {:search_box=>"permissionsSearchBox",:paginator_box=>"regionPaginator"})%>
        <div id="regionPaginator"></div>
      </div>
    </div>
</div>

<script type="text/javascript">
  GY.use("irm",function(Y){
    //其中delegate 方法需要去找到针对于谁进行委托，这个时候，我们
    //需要制定针对id为rptminitabsbody下面的class为reportClass
    //进行dom元素进行处理
    Y.one('#rptminitabsbody').delegate("click",function(e){
          if(this.hasClass("showListButton")){
            this.removeClass("showListButton");
            this.addClass("hideListButton");
            Y.one('#'+this.getAttribute("child_id")).setStyle("display","block");
          }
          else{
            this.removeClass("hideListButton");
            this.addClass("showListButton");
            Y.one('#'+this.getAttribute("child_id")).setStyle("display","none");
          }

        }, '.reportClass')
  });
</script>

<div id="rptminitabsbody">
  <div class="bPageBlock secondaryPalette">
    <div class="pbHeader">
      <div class="buttons">
      </div>
    </div>
    <div class="pbBody">
      <div class="reportList">
        <%= raw(show_category_report("","SYSTEM_GLOBAL")) %>
        <%= raw(show_category_report("","INCIDENT_REQUEST")) %>
        <%= raw(show_category_report("","SURVEY")) %>
        <%= raw(show_category_report("","SERVICE_KNOWLEDGE_MANAGE")) %>
      </div>
    </div>
  </div>
</div>

<% content_for :sidebar do %>
    <%= render :partial =>"/irm/common/recently_objects" %>
<% end %>